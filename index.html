<!DOCTYPE html>
<html lang="pt-BR"> <!-- O atributo lang ser√° atualizado pelo JS -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feliz dias dos enamorados, Bibia</title> <!-- O t√≠tulo tamb√©m ser√° atualizado pelo JS -->
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Parisienne&family=Poppins:wght@300;400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script> 
    <link rel="stylesheet" href="estilo.css"> <!-- Chamada para o CSS externo -->
</head>
<body>
    <!-- Pop-up Inicial -->
    <div id="initialPopup" class="popup-overlay">
        <div class="popup-content">
            <h2 data-lang="popupTitle">Aten√ß√£o, Bumbum de Jujuba!</h2>
            <svg class="hypnosis-watch-svg" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
                <g class="watch-group">
                    <line x1="50" y1="10" x2="50" y2="40" stroke="#a0522d" stroke-width="3" /> <circle cx="50" cy="10" r="3" fill="#a0522d" /> 
                    <circle cx="50" cy="70" r="30" fill="#f0e68c" stroke="#8b4513" stroke-width="3" />
                    <path d="M50,70 Q65,55 50,55 Q35,55 50,70 M50,55 Q60,62.5 50,62.5 Q40,62.5 50,55 M50,62.5 Q55,66.25 50,66.25 Q45,66.25 50,62.5 M50,66.25 Q52.5,68.125 50,68.125 Q47.5,68.125 50,66.25" 
                          stroke="#8b4513" stroke-width="1.5" fill="none" /> <circle cx="50" cy="70" r="3" fill="#8b4513" /> 
                </g>
            </svg>
            <p style="font-size: 1.2em; color: #555; margin-bottom: 25px;" data-lang="popupMessage">Voc√™ vai se apaixonar mais ainda pelo seu namorado, bumbum de jujuba.</p>
            <div class="popup-buttons">
                <button id="popupYesButton" data-lang="popupYes">Sim!</button>
                <button id="popupNoButton" class="no-button" data-lang="popupNo">N√£o...</button>
            </div>
        </div>
    </div>
    <!-- Fim Pop-up Inicial -->

    <!-- Rose Fireworks Container -->
    <div id="roseFireworksContainer"></div>
    <!-- End Rose Fireworks Container -->

    <!-- Barra "Tocando Agora" com Seletores -->
    <div class="now-playing-bar">
        <p><span class="music-icon">üéµ</span> <span data-lang="nowPlaying">Tocando agora</span>: <span id="currentSongName" data-lang-default="Nenhuma m√∫sica" aria-live="polite">Nenhuma m√∫sica</span></p> 
        <span id="dancingDuck">ü¶Ü</span> 
        <select id="songSelector"></select> 
        <select id="languageSelectorDropdown"></select> 
    </div>
    <!-- Fim Barra "Tocando Agora" -->
    
    <header class="header">
        <h1 data-lang="mainTitle">Para Meu Amor Bibia <span class="heart">‚ù§</span></h1>
    </header>

    <div class="audio-player-container">
        <audio id="backgroundMusic" loop preload="auto"> Seu navegador n√£o suporta o elemento de √°udio. </audio>
    </div>

    <main class="container">
        <!-- Gallery Section with Carousel -->
        <section class="gallery-carousel">
            <div class="carousel-slides">
                <div class="carousel-slide">
                    <img src="images/image1.jpg" alt="Bibia - Foto 1" data-lang-alt="altImage1" loading="lazy"
                         onerror="this.onerror=null;this.src='https://placehold.co/600x400/f8bbd0/c2185b?text=Imagem+1+Nao+Encontrada';">
                    <p data-lang="captionImage1">"Seu sorriso ilumina meus dias..."</p>
                </div>
                <div class="carousel-slide">
                    <img src="images/image2.jpg" alt="Bibia - Foto 2" data-lang-alt="altImage2" loading="lazy"
                         onerror="this.onerror=null;this.src='https://placehold.co/600x400/f8bbd0/c2185b?text=Imagem+2+Nao+Encontrada';">
                    <p data-lang="captionImage2">"...e seus olhinhos de jabuticaba me encantam!"</p>
                </div>
            </div>
            <button class="carousel-button prev" onclick="moveSlide(-1)">&#10094;</button>
            <button class="carousel-button next" onclick="moveSlide(1)">&#10095;</button>
        </section>
        <!-- End Gallery Section -->

        <section class="declaration-container">
            <div id="passwordPrompt" class="password-prompt">
                <h2 data-lang="passwordPromptTitle">Uma pergunta especial...</h2>
                <p data-lang="passwordPromptQuestion">Aceita namorar comigo?</p>
                <input type="password" id="passwordInput" data-lang-placeholder="passwordPlaceholder" placeholder="Sua resposta aqui..." class="text-center">
                <br>
                <button id="submitPasswordButton" data-lang="passwordButton">Revelar Mensagem</button>
                <p id="errorMessage" class="error-message" style="display: none;" data-lang-default="Ops! Resposta incorreta. Tente novamente."></p>
            </div>
            <div id="letterContent" class="letter-content"> 
                <h3 data-lang="letterTitle">Declara√ß√£o do √öltimo Rom√¢ntico</h3>
                <p class="min-h-[100px]" data-lang-declaration="letterContentText" 
                   data-text-source-pt="Querida Bibia,<br><br>Desde que voc√™ entrou na minha vida, tudo se tornou mais colorido e cheio de alegria. Seu jeito √∫nico, seus olhinhos de jabuticaba e a forma como voc√™ v√™ o mundo me encantam todos os dias.<br><br>Neste Dia dos Namorados, quero demonstrar o quanto voc√™ √© importante para mim. Voc√™ √© minha inspira√ß√£o, minha c√∫mplice e o meu amor.<br><br>Espero que este pequeno gesto possa demonstrar um pouco do imenso carinho que sinto por voc√™. E se a sua resposta para aquela pergunta for sim, saiba que voc√™ acabou de me fazer a pessoa mais feliz do mundo!"
                   data-text-source-es="Querida Bibia,<br><br>Desde que entraste en mi vida, todo se ha vuelto m√°s colorido y lleno de alegr√≠a. Tu forma de ser √∫nica, tus ojitos de jabuticaba y la forma en que ves el mundo me encantan todos los d√≠as.<br><br>En este D√≠a de San Valent√≠n, quiero demostrar cu√°nto significas para m√≠. Eres mi inspiraci√≥n, mi c√≥mplice y mi amor.<br><br>Espero que este pequeno gesto pueda demostrar un poco del inmenso cari√±o que siento por ti. Y si tu respuesta a esa pregunta es s√≠, ¬°que sepas que acabas de hacerme la persona m√°s feliz del mundo!"></p>
                <!-- O tempo de namoro, dias dos namorados e assinatura ser√£o adicionados aqui pelo JavaScript -->
            </div>
        </section>
    </main>

    <footer class="footer">
        <p data-lang="footerMadeWithLove">Feito com <span class="heart">‚ù§</span> especialmente para Bibia!</p>
        <p><a href="pagina2.html" class="back-link" style="margin-top:10px; display:inline-block;" data-lang="viewFutureGallery">Nossa Galeria de fotos</a></p> 
        <p data-lang="footerCopyright" style="margin-top:10px;">&copy; 2025 - Um dia dos namorados inesquec√≠vel.</p>
    </footer>

    <script>
        const initialPopup = document.getElementById('initialPopup');
        const popupYesButton = document.getElementById('popupYesButton');
        const popupNoButton = document.getElementById('popupNoButton');
        const roseFireworksContainer = document.getElementById('roseFireworksContainer');
        const dancingDuck = document.getElementById('dancingDuck'); 
        const passwordInput = document.getElementById('passwordInput');
        const submitPasswordButton = document.getElementById('submitPasswordButton');
        const passwordPrompt = document.getElementById('passwordPrompt');
        const letterContent = document.getElementById('letterContent');
        const errorMessage = document.getElementById('errorMessage');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const declarationParagraph = letterContent.querySelector('p');
        const currentSongNameDisplay = document.getElementById('currentSongName');
        const songSelector = document.getElementById('songSelector'); 
        const languageSelectorDropdown = document.getElementById('languageSelectorDropdown'); 
        const correctAnswer = "oss";
        const relationshipStartDate = new Date(2022, 10, 26); 
        const valentinesDayMonth = 5; 
        const valentinesDayDate = 12;

        const originalSongList = [
            { path: 'music/blurry.mp3', displayNamePt: 'Blurry', displayNameEs: 'Blurry' },
            { path: 'music/justlikeheaven.mp3', displayNamePt: 'Just Like Heaven', displayNameEs: 'Just Like Heaven' },
            { path: 'music/nothingcompares2u.mp3', displayNamePt: 'Nothing Compares 2 U', displayNameEs: 'Nothing Compares 2 U' }
        ];
        let shuffledPlaylist = []; 
        let currentTrackInShuffledList = 0; 
        let currentLanguage = 'pt'; 
        let currentSlide = 0;
        const slides = document.querySelector('.carousel-slides');
        const totalSlides = slides ? slides.children.length : 0; 
        let titleScrollerInterval; 

        const langStrings = {
            pt: {
                pageTitle: "Feliz dias dos enamorados, Bibia ‚ù§Ô∏è",
                popupTitle: "Aten√ß√£o, Bumbum de Jujuba!",
                popupMessage: "Voc√™ vai se apaixonar mais ainda pelo seu namorado, bumbum de jujuba.",
                popupYes: "Sim!",
                popupNo: "N√£o...",
                nowPlaying: "Tocando agora",
                noMusic: "Nenhuma m√∫sica",
                mainTitle: "Para Meu Amor Bibia <span class=\"heart\">‚ù§</span>",
                altImage1: "Bibia - Foto 1",
                captionImage1: "\"Seu sorriso ilumina meus dias...\"",
                altImage2: "Bibia - Foto 2",
                captionImage2: "\"...e seus olhinhos de jabuticaba me encantam!\"",
                passwordPromptTitle: "Uma pergunta especial...",
                passwordPromptQuestion: "Aceita namorar comigo?",
                passwordPlaceholder: "Sua resposta aqui...",
                passwordButton: "Revelar Mensagem",
                passwordError: "Ops! Resposta incorreta. Voc√™ se recorda a palavra que disse ao namorar comigo?", // MODIFICADO AQUI
                letterTitle: "Declara√ß√£o do √öltimo Rom√¢ntico",
                relationshipDurationPrefix: "Nosso tempo juntos: ",
                relationshipDurationSuffixPt: "(desde 26/11/2022).",
                valentinesCountText: "Dias dos Namorados juntos: ",
                signature: "<br><br>Com todo o meu amor,<br>Gabriel.",
                yearsText: "anos",
                monthsText: "meses",
                daysText: "dias",
                andText: "e",
                viewFutureGallery: "Nossa Galeria de fotos",
                footerMadeWithLove: "Feito com <span class=\"heart\">‚ù§</span> especialmente para Bibia!",
                footerCopyright: "&copy; 2025 - Um dia dos namorados inesquec√≠vel."
            },
            es: {
                pageTitle: "Feliz D√≠a de San Valent√≠n, Bibia ‚ù§Ô∏è",
                popupTitle: "¬°Atenci√≥n, Bomb√≥n de Jujuba!",
                popupMessage: "Te vas a enamorar a√∫n m√°s de tu novio, bomb√≥n de jujuba.",
                popupYes: "¬°S√≠!",
                popupNo: "No...",
                nowPlaying: "Escuchando ahora",
                noMusic: "Ninguna canci√≥n",
                mainTitle: "Para Mi Amor Bibia <span class=\"heart\">‚ù§</span>",
                altImage1: "Bibia - Foto 1",
                captionImage1: "\"Tu sonrisa ilumina mis d√≠as...\"",
                altImage2: "Bibia - Foto 2",
                captionImage2: "\"...¬°y tus ojitos de jabuticaba me encantan!\"",
                passwordPromptTitle: "Una pregunta especial...",
                passwordPromptQuestion: "¬øAceptas ser mi novia?",
                passwordPlaceholder: "Tu respuesta aqu√≠...",
                passwordButton: "Revelar Mensaje",
                passwordError: "¬°Uy! Respuesta incorrecta. ¬øRecuerdas la palabra que dijiste al aceptar ser mi novia?", // MODIFICADO AQUI
                letterTitle: "Declaraci√≥n del √öltimo Rom√°ntico",
                relationshipDurationPrefix: "Nuestro tiempo juntos: ",
                relationshipDurationSuffixEs: "(desde el 26/11/2022).",
                valentinesCountText: "D√≠as de San Valent√≠n juntos: ",
                signature: "<br><br>Con todo mi amor,<br>Gabriel.",
                yearsText: "a√±os",
                monthsText: "meses",
                daysText: "d√≠as",
                andText: "y",
                viewFutureGallery: "Nuestra Galer√≠a de fotos",
                footerMadeWithLove: "¬°Hecho con <span class=\"heart\">‚ù§</span> especialmente para Bibia!",
                footerCopyright: "&copy; 2025 - Un D√≠a de San Valent√≠n inolvidable."
            }
        };

        function showSlide(index) { if (slides) { slides.style.transform = `translateX(-${index * 100}%)`; } }
        function moveSlide(n) { if (totalSlides > 0) { currentSlide = (currentSlide + n + totalSlides) % totalSlides; showSlide(currentSlide); } }
        function createRoseParticle(x, y) { const particle = document.createElement('div'); particle.classList.add('rose-particle'); particle.innerHTML = 'üåπ'; particle.style.left = x + 'px'; particle.style.top = y + 'px'; roseFireworksContainer.appendChild(particle); const angle = Math.random() * Math.PI * 2; const speed = Math.random() * 5 + 2; const gravity = 0.1; let vx = Math.cos(angle) * speed; let vy = Math.sin(angle) * speed; let opacity = 1; let rotation = 0; const rotationSpeed = (Math.random() - 0.5) * 20; function animateParticle() { vx *= 0.98; vy += gravity; particle.style.left = (parseFloat(particle.style.left) + vx) + 'px'; particle.style.top = (parseFloat(particle.style.top) + vy) + 'px'; rotation += rotationSpeed; particle.style.transform = `rotate(${rotation}deg) scale(${opacity})`; opacity -= 0.015; if (opacity > 0) { requestAnimationFrame(animateParticle); } else { particle.remove(); } } requestAnimationFrame(() => { particle.style.opacity = 1; requestAnimationFrame(animateParticle); }); }
        function launchRoseFirework(count = 1) { for(let i = 0; i < count; i++) { const startX = Math.random() * window.innerWidth; const startY = window.innerHeight + 50; const numParticles = Math.floor(Math.random() * 20) + 15; const launchDuration = Math.random() * 500 + 300; setTimeout(() => { const explosionX = startX; const explosionY = Math.random() * (window.innerHeight / 2) + (window.innerHeight / 4); for (let j = 0; j < numParticles; j++) { createRoseParticle(explosionX, explosionY); } }, launchDuration); } }
        popupYesButton.addEventListener('click', () => {
            initialPopup.style.display = 'none';
            launchRoseFirework(5); 
            if (backgroundMusic.paused) {
                 if (shuffledPlaylist.length === 0 || currentTrackInShuffledList >= shuffledPlaylist.length) {
                    prepareShuffledPlaylist(); 
                }
                playNextSongInShuffle(); 
            }
        });
        popupNoButton.addEventListener('click', () => { window.location.href = 'https://www.google.com'; });
        function shuffleArray(array) { let currentIndex = array.length, randomIndex; while (currentIndex !== 0) { randomIndex = Math.floor(Math.random() * currentIndex); currentIndex--; [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]; } return array; }
        function prepareShuffledPlaylist() { shuffledPlaylist = shuffleArray([...originalSongList]); currentTrackInShuffledList = 0; }
        function formatSongName(songObject) { 
            if (!songObject) return langStrings[currentLanguage].noMusic;
            return currentLanguage === 'es' ? songObject.displayNameEs : songObject.displayNamePt;
        }
        function loadAndPlaySong(songObject, isUserSelection = false) {
            if (!songObject || !songObject.path) { currentSongNameDisplay.textContent = langStrings[currentLanguage].noMusic; return; }
            const songPath = songObject.path;
            while (backgroundMusic.firstChild) { backgroundMusic.removeChild(backgroundMusic.firstChild); }
            const sourceElement = document.createElement('source'); sourceElement.src = songPath; sourceElement.type = 'audio/mpeg'; backgroundMusic.appendChild(sourceElement);
            backgroundMusic.load();
            backgroundMusic.play().then(() => {
                currentSongNameDisplay.textContent = formatSongName(songObject);
                if(songSelector) songSelector.value = songPath; 
                if(dancingDuck) dancingDuck.classList.add('duck-dance');
            }).catch(error => {
                console.log("Autoplay da m√∫sica '" + songPath + "' impedido: ", error);
                currentSongNameDisplay.textContent = langStrings[currentLanguage].noMusic + " (Erro)";
                if(dancingDuck) dancingDuck.classList.remove('duck-dance');
            });
            if (isUserSelection) {
                const selectedIndexInShuffle = shuffledPlaylist.findIndex(s => s.path === songPath);
                if (selectedIndexInShuffle !== -1) { currentTrackInShuffledList = (selectedIndexInShuffle + 1); } 
                else { prepareShuffledPlaylist(); const newIdx = shuffledPlaylist.findIndex(s => s.path === songPath); if(newIdx !== -1) currentTrackInShuffledList = (newIdx + 1); }
            }
        }
        function playNextSongInShuffle() {
            if (originalSongList.length === 0) { currentSongNameDisplay.textContent = langStrings[currentLanguage].noMusic; return; }
            if (currentTrackInShuffledList >= shuffledPlaylist.length || shuffledPlaylist.length === 0) { prepareShuffledPlaylist(); }
            const songToPlay = shuffledPlaylist[currentTrackInShuffledList];
            if(songToPlay){ loadAndPlaySong(songToPlay); currentTrackInShuffledList++; } 
            else { prepareShuffledPlaylist(); if(shuffledPlaylist.length > 0) { loadAndPlaySong(shuffledPlaylist[0]); currentTrackInShuffledList = 1; } }
        }
        backgroundMusic.addEventListener('ended', playNextSongInShuffle);
        backgroundMusic.onpause = () => { if(dancingDuck) dancingDuck.classList.remove('duck-dance'); };
        backgroundMusic.onplay = () => { if(dancingDuck) dancingDuck.classList.add('duck-dance'); };
        function populateSongSelector() { 
            if (!songSelector) return; 
            songSelector.innerHTML = ''; 
            originalSongList.forEach(songObj => {
                const option = document.createElement('option');
                option.value = songObj.path;
                option.textContent = formatSongName(songObj); 
                songSelector.appendChild(option);
            });
            const currentSource = backgroundMusic.querySelector('source');
            if (currentSource) {
                const playingSongObj = originalSongList.find(s => s.path === currentSource.getAttribute('src'));
                if (playingSongObj) {
                    currentSongNameDisplay.textContent = formatSongName(playingSongObj);
                    songSelector.value = playingSongObj.path;
                }
            } else {
                 currentSongNameDisplay.textContent = langStrings[currentLanguage].noMusic;
            }
        }
        if(songSelector){ 
            songSelector.addEventListener('change', function() {
                const selectedPath = this.value;
                const selectedSongObject = originalSongList.find(song => song.path === selectedPath);
                if (selectedSongObject) {
                    loadAndPlaySong(selectedSongObject, true);
                }
            });
        }
        function typeWriter(element, text, speed, callback) {
            let i = 0;
            element.innerHTML = ""; 
            element.classList.add('typewriter-text'); 
            function type() {
                if (i < text.length) {
                    if (text.substring(i, i + 4).toLowerCase() === '<br>') {
                        element.innerHTML += '<br>';
                        i += 4;
                    } else {
                        element.innerHTML += text.charAt(i);
                        i++;
                    }
                    setTimeout(type, speed);
                } else {
                    element.classList.remove('typewriter-text'); 
                    if (callback) callback();
                }
            }
            type();
        }
        function calculateRelationshipDuration(startDate) {
            const today = new Date(2025, 5, 5); 
            let years = today.getFullYear() - startDate.getFullYear();
            let months = today.getMonth() - startDate.getMonth();
            let days = today.getDate() - startDate.getDate();
            if (days < 0) { months--; const daysInLastMonth = new Date(today.getFullYear(), today.getMonth(), 0).getDate(); days += daysInLastMonth; }
            if (months < 0) { years--; months += 12; }
            return { years, months, days };
        }
        function calculateValentinesDays(startDate) {
            const today = new Date(2025, 5, 5); 
            let count = 0; const startYear = startDate.getFullYear(); const currentYear = today.getFullYear();
            for (let year = startYear; year <= currentYear; year++) {
                const valentinesThisYear = new Date(year, valentinesDayMonth, valentinesDayDate);
                if (year === startYear) { 
                    if (startDate < valentinesThisYear && today >= valentinesThisYear) { count++; } 
                    else if (startDate < valentinesThisYear && year < currentYear) { count++; }
                } else if (year < currentYear) { count++; } 
                else { if (today >= valentinesThisYear) { count++; } }
            }
            return count;
        }
        function displayRelationshipInfo() {
            const duration = calculateRelationshipDuration(relationshipStartDate);
            const valentinesCount = calculateValentinesDays(relationshipStartDate);
            const lang = currentLanguage;
            let durationParts = [];
            if (duration.years > 0) { durationParts.push(`${duration.years} ${langStrings[lang].yearsText}`); }
            if (duration.months > 0) { durationParts.push(`${duration.months} ${langStrings[lang].monthsText}`); }
            if (duration.days > 0) { durationParts.push(`${duration.days} ${langStrings[lang].daysText}`); }
            let durationString = "";
            if (durationParts.length === 0) { durationString = "Hoje!"; } 
            else if (durationParts.length === 1) { durationString = durationParts[0]; } 
            else if (durationParts.length === 2) { durationString = durationParts.join(` ${langStrings[lang].andText} `); } 
            else { const lastPart = durationParts.pop(); durationString = durationParts.join(", ") + ` ${langStrings[lang].andText} ${lastPart}`; }
            letterContent.querySelectorAll(".dynamic-info").forEach(el => el.remove());
            const durationElement = document.createElement('p'); durationElement.id = "relationshipTime"; durationElement.classList.add("dynamic-info"); durationElement.style.marginTop = "20px"; durationElement.style.fontStyle = "italic"; durationElement.style.fontSize = "1em"; const durationSuffixKey = lang === 'pt' ? 'relationshipDurationSuffixPt' : 'relationshipDurationSuffixEs'; durationElement.innerHTML = `${langStrings[lang].relationshipDurationPrefix}<strong>${durationString}</strong> ${langStrings[lang][durationSuffixKey]}`; letterContent.appendChild(durationElement);
            const valentinesElement = document.createElement('p'); valentinesElement.id = "valentinesCount"; valentinesElement.classList.add("dynamic-info"); valentinesElement.style.fontStyle = "italic"; valentinesElement.style.fontSize = "1em"; valentinesElement.innerHTML = `${langStrings[lang].valentinesCountText}<strong>${valentinesCount}</strong> ‚ù§Ô∏è`; letterContent.appendChild(valentinesElement);
            const signatureElement = document.createElement('p'); signatureElement.id = "signature"; signatureElement.classList.add("dynamic-info"); signatureElement.style.marginTop = "5px"; signatureElement.style.textAlign = "right"; signatureElement.innerHTML = langStrings[lang].signature; letterContent.appendChild(signatureElement);
        }
        function updateTextContent(lang) {
            document.documentElement.lang = lang.toUpperCase(); 
            localStorage.setItem('minisiteLanguage', lang); 
            const elements = document.querySelectorAll('[data-lang]');
            elements.forEach(el => {
                const key = el.dataset.lang;
                if (langStrings[lang] && langStrings[lang][key]) { el.innerHTML = langStrings[lang][key]; }
            });
            const altElements = document.querySelectorAll('[data-lang-alt]');
            altElements.forEach(el => {
                const key = el.dataset.langAlt;
                if (langStrings[lang] && langStrings[lang][key]) { el.alt = langStrings[lang][key]; }
            });
            const placeholderElements = document.querySelectorAll('[data-lang-placeholder]');
            placeholderElements.forEach(el => {
                const key = el.dataset.langPlaceholder;
                 if (langStrings[lang] && langStrings[lang][key]) { el.placeholder = langStrings[lang][key]; }
            });
            const pageTitleKey = 'pageTitle';
             if (langStrings[lang] && langStrings[lang][pageTitleKey]) { document.title = langStrings[lang][pageTitleKey]; }
            const defaultSongDisplay = document.querySelector('[data-lang-default]');
            if(defaultSongDisplay && backgroundMusic.paused && !backgroundMusic.currentTime) { 
                currentSongNameDisplay.textContent = langStrings[lang].noMusic;
            }
            populateSongSelector(); 
            if(languageSelectorDropdown) languageSelectorDropdown.value = lang; 
            if (letterContent.style.display === 'block') {
                const declarationTextKey = `data-text-source-${currentLanguage}`;
                const newDeclarationText = declarationParagraph.getAttribute(declarationTextKey) || declarationParagraph.getAttribute('data-text-source-pt');
                typeWriter(declarationParagraph, newDeclarationText, 0, () => { displayRelationshipInfo(); });
            }
        }
        function populateLanguageSelector() {
            if (!languageSelectorDropdown) return;
            languageSelectorDropdown.innerHTML = ''; 
            const ptOption = document.createElement('option'); ptOption.value = 'pt'; ptOption.textContent = 'üáßüá∑'; languageSelectorDropdown.appendChild(ptOption);
            const esOption = document.createElement('option'); esOption.value = 'es'; esOption.textContent = 'üá™üá∏'; languageSelectorDropdown.appendChild(esOption);
            languageSelectorDropdown.value = currentLanguage; 
        }
        if (languageSelectorDropdown) {
            languageSelectorDropdown.addEventListener('change', function() {
                currentLanguage = this.value;
                updateTextContent(this.value);
                clearTimeout(titleScrollerInterval); 
                startTitleScroller(langStrings[currentLanguage].pageTitle + "                "); 
            });
        }
        submitPasswordButton.addEventListener('click', function() {
            const enteredPassword = passwordInput.value.trim().toLowerCase();
            if (enteredPassword === correctAnswer) {
                passwordPrompt.style.display = 'none';
                letterContent.style.display = 'block';
                errorMessage.style.display = 'none';
                const declarationTextKey = `data-text-source-${currentLanguage}`;
                const originalText = declarationParagraph.getAttribute(declarationTextKey) || declarationParagraph.getAttribute('data-text-source-pt'); 
                typeWriter(declarationParagraph, originalText, 50, () => { displayRelationshipInfo(); }); 
                setTimeout(() => { declarationParagraph.contentEditable = "false";  }, 100);
                if (backgroundMusic.paused && (shuffledPlaylist.length > 0 && currentTrackInShuffledList < shuffledPlaylist.length)) {
                     const songToPlay = shuffledPlaylist[currentTrackInShuffledList] || shuffledPlaylist[0];
                     if(songToPlay) loadAndPlaySong(songToPlay);
                } else if (!backgroundMusic.paused) { 
                     const currentSource = backgroundMusic.querySelector('source');
                     if(currentSource){
                        const playingSongObj = originalSongList.find(s => s.path === currentSource.getAttribute('src'));
                        if(playingSongObj) {
                            currentSongNameDisplay.textContent = formatSongName(playingSongObj);
                            if(songSelector) songSelector.value = playingSongObj.path; 
                        }
                     }
                } else if (backgroundMusic.paused && originalSongList.length > 0) { 
                    playNextSongInShuffle();
                }
            } else {
                errorMessage.textContent = langStrings[currentLanguage].passwordError; 
                errorMessage.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        });
        passwordInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                submitPasswordButton.click();
            }
        });
        function startTitleScroller(text) {
            clearTimeout(titleScrollerInterval); 
            let currentDisplayTitle = text;
            function scroll() {
                document.title = currentDisplayTitle;
                currentDisplayTitle = currentDisplayTitle.substring(1) + currentDisplayTitle.substring(0,1);
                titleScrollerInterval = setTimeout(scroll, 300);
            }
            scroll();
        }
        if (totalSlides > 0) { showSlide(currentSlide); } 
        prepareShuffledPlaylist(); 
        populateLanguageSelector(); 
        updateTextContent(currentLanguage); 
        startTitleScroller(langStrings[currentLanguage].pageTitle + "                ");
    </script>
</body>
</html>
